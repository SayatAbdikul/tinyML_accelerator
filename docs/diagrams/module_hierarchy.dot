// Module Hierarchy
// Use: dot -Tpng module_hierarchy.dot -o module_hierarchy.png

digraph Module_Hierarchy {
    rankdir=TB;
    node [shape=box, style="rounded,filled"];
    
    // Top level
    top [label="tinyml_accelerator_top\n(220 lines)", fillcolor=lightblue];
    
    // Level 1
    fetch [label="fetch_unit\n(97 lines)", fillcolor=lightyellow];
    decoder [label="i_decoder\n(46 lines)", fillcolor=lightyellow];
    exec [label="modular_execution_unit\n(482 lines)", fillcolor=lightpink];
    
    // Level 2 - Fetch
    mem_fetch [label="simple_memory\n(Instructions)", fillcolor=lightgray, shape=cylinder];
    
    // Level 2 - Execution
    buf_ctrl [label="buffer_controller\n(~200 lines)", fillcolor=lightcyan];
    load_exec [label="load_execution\n(~200 lines)", fillcolor=lightcyan];
    gemv_exec [label="gemv_execution\n(~200 lines)", fillcolor=lightcyan];
    relu_exec [label="relu_execution\n(~150 lines)", fillcolor=lightcyan];
    store_exec [label="store_execution\n(~150 lines)", fillcolor=lightcyan];
    
    // Level 3 - Buffer Controller
    buf_vec [label="buffer_file\n(Vector Buffers)\n(113 lines)", fillcolor=white];
    buf_mat [label="buffer_file\n(Matrix Buffers)\n(113 lines)", fillcolor=white];
    
    // Level 3 - Load Execution
    load_v [label="load_v\n(~150 lines)", fillcolor=white];
    load_m [label="load_m\n(~150 lines)", fillcolor=white];
    mem_loadv [label="simple_memory\n(Load_V)", fillcolor=lightgray, shape=cylinder];
    mem_loadm [label="simple_memory\n(Load_M)", fillcolor=lightgray, shape=cylinder];
    
    // Level 3 - GEMV Execution
    top_gemv [label="top_gemv\n(366 lines)", fillcolor=white];
    
    // Level 3 - ReLU Execution
    relu [label="relu\n(~100 lines)", fillcolor=white];
    
    // Level 3 - Store Execution
    store [label="store\n(~150 lines)", fillcolor=white];
    mem_store [label="simple_memory\n(Store)", fillcolor=lightgray, shape=cylinder];
    
    // Level 4 - GEMV internals
    pe [label="pe[0:31]\n(32 instances)\n(25 lines each)", fillcolor=lightgreen];
    quant [label="quantization\n(107 lines)", fillcolor=lightgreen];
    
    // Level 5 - Quantization internals
    quant_pipe [label="quantizer_pipeline\n(~100 lines)", fillcolor=lightyellow];
    scale_calc [label="scale_calculator\n(~150 lines)", fillcolor=lightyellow];
    
    // Level 6 - Scale calculator
    wallace [label="wallace_32x32\n(~400 lines)", fillcolor=orange];
    
    // Level 7 - Wallace tree
    compressor [label="compressor_3to2\n(15 lines)", fillcolor=pink];
    
    // Connections
    top -> fetch;
    top -> decoder;
    top -> exec;
    
    fetch -> mem_fetch;
    
    exec -> buf_ctrl;
    exec -> load_exec;
    exec -> gemv_exec;
    exec -> relu_exec;
    exec -> store_exec;
    
    buf_ctrl -> buf_vec;
    buf_ctrl -> buf_mat;
    
    load_exec -> load_v;
    load_exec -> load_m;
    load_v -> mem_loadv;
    load_m -> mem_loadm;
    
    gemv_exec -> top_gemv;
    
    top_gemv -> pe [label="32Ã—"];
    top_gemv -> quant;
    
    quant -> quant_pipe;
    quant -> scale_calc;
    
    scale_calc -> wallace;
    
    wallace -> compressor [label="multiple\ninstances"];
    
    relu_exec -> relu;
    
    store_exec -> store;
    store -> mem_store;
}
